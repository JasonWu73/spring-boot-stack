<?xml version="1.0" encoding="UTF-8"?>
<!--
  如果要将 `logback-spring.xml` 放在 Jar 包之外，则要明确指定配置文件的路径：
  `java -Dlogging.config=file:./config/logback-spring.xml -jar xxx.jar`
-->
<configuration>
  <!-- 先定义属性，防止被覆盖 -->
  <property
    name="CONSOLE_LOG_PATTERN"
    value="${CONSOLE_LOG_PATTERN:-%clr(%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr(%applicationName[%15.15t]){faint} %clr(${LOG_CORRELATION_PATTERN:-}){faint}%clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"
  />
  <property
    name="FILE_LOG_PATTERN"
    value="${FILE_LOG_PATTERN:-%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}} ${LOG_LEVEL_PATTERN:-%5p} ${PID:- } --- %applicationName[%t] ${LOG_CORRELATION_PATTERN:-}%-40.40logger{39} : %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"
  />
  <property name="LOG_FILE_DIR" value="logs"/>
  <property name="LOG_FILE_NAME" value="web"/>
  <property name="MAX_FILE_SIZE" value="100MB"/>
  <property name="MAX_HISTORY" value="60"/>
  <property name="TOTAL_SIZE_CAP" value="20GB"/>

  <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
  <include
    resource="org/springframework/boot/logging/logback/console-appender.xml"
  />

  <appender
    name="LOG_FILE"
    class="ch.qos.logback.core.rolling.RollingFileAppender"
  >
    <file>${LOG_FILE_DIR}/${LOG_FILE_NAME}.log</file>
    <encoder>
      <pattern>${FILE_LOG_PATTERN}</pattern>
      <charset>${FILE_LOG_CHARSET}</charset>
    </encoder>

    <rollingPolicy
      class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"
    >
      <fileNamePattern>
        ${LOG_FILE_DIR}/${LOG_FILE_NAME}-%d{yyyy-MM-dd}.%i.log
      </fileNamePattern>
      <maxFileSize>${MAX_FILE_SIZE}</maxFileSize>
      <maxHistory>${MAX_HISTORY}</maxHistory>
      <totalSizeCap>${TOTAL_SIZE_CAP}</totalSizeCap>
      <cleanHistoryOnStart>true</cleanHistoryOnStart>
    </rollingPolicy>
  </appender>

  <!--
  <logger name="com.zaxxer.hikari" level="TRACE" additivity="false">
    <appender-ref ref="CONSOLE"/>
  </logger>
  -->

  <root level="INFO">
    <appender-ref ref="CONSOLE"/>
    <!-- <appender-ref ref="LOG_FILE"/> -->
  </root>
</configuration>
